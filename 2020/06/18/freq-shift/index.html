<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link title="astrid.tech RSS" rel="alternate" type="application/rss+xml" href="https://astrid.tech/rss.xml"/><link title="astrid.tech Atom" rel="alternate" type="application/atom+xml" href="https://astrid.tech/atom.xml"/><link title="astrid.tech JSON feed" rel="alternate" type="application/feed+json" href="https://astrid.tech/feed.json"/><link href="https://github.com/astralbijection" rel="me authn"/><link href="mailto:astrid@astrid.tech" rel="me"/><title>Down-shifting and filtering a signal | astrid.tech</title><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="description" content="Because the FPGA is fast, but not *that* fast"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="astralbijection"/><meta name="twitter:title" content="Down-shifting and filtering a signal"/><meta name="twitter:description" content="Because the FPGA is fast, but not *that* fast"/><meta property="og:title" content="Down-shifting and filtering a signal"/><meta property="og:description" content="Because the FPGA is fast, but not *that* fast"/><meta property="og:type" content="website"/><meta name="robots" content="follow,index"/><meta property="og:url" content="https:/astrid.tech/2020/06/18/freq-shift"/><link title="astrid.tech RSS" rel="alternate" type="application/rss+xml" href="https://astrid.tech/rss.xml"/><link title="astrid.tech Atom" rel="alternate" type="application/atom+xml" href="https://astrid.tech/atom.xml"/><link title="astrid.tech JSON feed" rel="alternate" type="application/feed+json" href="https://astrid.tech/feed.json"/><link href="https://github.com/astralbijection" rel="me authn"/><link href="mailto:astrid@astrid.tech" rel="me"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/1d0d198a1c5bdedcad14.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1d0d198a1c5bdedcad14.css" data-n-g=""/><link rel="preload" href="/_next/static/css/bd89e56ee668535d8996.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bd89e56ee668535d8996.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-e7a279300235e161e32a.js"></script><script src="/_next/static/chunks/webpack-3071412ed8bc8fc49fc7.js" defer=""></script><script src="/_next/static/chunks/framework-2f612445bd50b211f15a.js" defer=""></script><script src="/_next/static/chunks/main-6bd02c179f9e0ec2bd5a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1658794de36b29c002aa.js" defer=""></script><script src="/_next/static/chunks/545f34e4-37710c009d2bbbd273c3.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-571001351e1ed221a25c.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-fc4f6c929a53a9b582f6.js" defer=""></script><script src="/_next/static/chunks/398-1b9f48eb99654eeda62b.js" defer=""></script><script src="/_next/static/chunks/264-b52c4cdeb9e69930784f.js" defer=""></script><script src="/_next/static/chunks/146-41f4f1c63257555b1b33.js" defer=""></script><script src="/_next/static/chunks/993-2df73c7cf8296f032349.js" defer=""></script><script src="/_next/static/chunks/705-c9d82552f3ea55b2fe7a.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5B...slug%5D-e11dd750811444406993.js" defer=""></script><script src="/_next/static/xu5MpDjzYRyNj4te1Gtrv/_buildManifest.js" defer=""></script><script src="/_next/static/xu5MpDjzYRyNj4te1Gtrv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="main-navbar navbar navbar-expand-md fixed-top"><a href="/" class="nav-link navbar-brand">astrid.tech</a><button aria-label="Toggle navigation" type="button" class="navbar-toggler"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M250.97 29.357c-106.557-.21-211.806 52.74-203.48 164.053 138.91 11.4 276.71 8.893 414.174.662 10.58-107.69-100.753-164.498-210.693-164.715zm59.876 23.996c11.165 0 20.216 4.468 20.216 9.98 0 5.513-9.051 9.981-20.216 9.981-11.166 0-20.217-4.468-20.217-9.98 0-5.513 9.051-9.98 20.217-9.98zm-111.852 19.83c11.165 0 20.217 4.469 20.217 9.98 0 5.513-9.052 9.981-20.217 9.981s-20.216-4.468-20.217-9.98c0-5.512 9.052-9.98 20.217-9.98zm178.057 34.02c11.165 0 20.216 4.468 20.217 9.98 0 5.512-9.052 9.98-20.217 9.98s-20.217-4.468-20.217-9.98c0-5.512 9.052-9.98 20.217-9.98zm-273.59 21.535c11.165 0 20.216 4.468 20.217 9.98 0 5.513-9.052 9.98-20.217 9.98s-20.217-4.467-20.217-9.98c0-5.512 9.052-9.98 20.217-9.98zm313.77 30.043c11.165 0 20.216 4.468 20.216 9.98 0 5.512-9.051 9.98-20.217 9.98-11.165 0-20.216-4.468-20.216-9.98 0-5.512 9.051-9.98 20.216-9.98zm-137.91 8.045c11.166 0 20.218 4.47 20.216 9.982 0 5.512-9.051 9.98-20.217 9.98-11.165 0-20.216-4.468-20.216-9.98-.002-5.513 9.05-9.982 20.216-9.982zM57.618 212.339c-18.964.405-9.028 24.485 14.383 24.573 128.554 10.208 236.673 9.686 372.117-2.42 16.096-2.708 25.212-13.087 10.824-21.969-131.579 7.67-263.81 10.045-397.324-.184zm403.024 40.612c-131.224 13.6-277.594 10.525-390.065 1.904-46.983-6.226-47.875 46.785-17.014 52.309 146.18 14.663 271.826 10.735 415.137-.53 25.007-1.144 14.554-55.328-8.058-53.683zM20.986 366.679l15.332 9.434c6.342-8.416 17.876-32.05 33.319-32.192 19.122-.174 22.345 39.302 41.98 39.103 22.607-.228 37.828-31.548 52.447-30.882 22.09 1.008 26.333 35.9 43.557 35.928 24.089.04 31.439-36.39 46.805-35.334 21.458 1.475 33.246 28.274 50.879 29.178 19.004.974 30.654-33.027 43.265-32.748 16.61.366 28.31 32.46 54.24 33.193 15.345.434 29.694-37.411 37.005-36.815 14.417 1.174 26.549 20.548 36.085 34.835l15.114-9.776c-12.029-16.216-30.117-44.428-52.558-44.017-20.907.382-25.948 38.114-38.102 37.943-23.28-.328-33.756-32.164-52.598-33.346-19.356-1.214-30.475 33.636-43.353 32.768-18.954-1.277-27.303-29.16-49.475-29.917-19.62-.67-34.121 37.669-46.793 36.044-18.139-2.326-20.226-36.378-43.317-37.836-19.11-1.207-37.562 30.604-50.314 29.999-17.525-.833-25.243-40.224-45.41-39.986-21.826.258-39.145 30.34-48.108 44.424zm47.553 36.174c-8.342.686-18.198 4.251-21.85 12.424-2.452 6.662 19.173 8.558 21.114 8.695 128.615 8.104 254.354 8.26 389.8-1.345 9.225-.655 13.935-3.147 15.252-4.414 3.124-8.208-23.168-13.935-25.818-14.004-185.01-1.178-279.257 2.209-378.498-1.356zm395.555 37.192c-126.786 6.957-283.18 9.384-408.123.707l.521 38.67c135.917 4.617 275.647 3.99 406.658-.088z"></path></svg></button><div class="collapse navbar-collapse"><a class="nav-link" href="/projects/">Projects</a><a class="nav-link active" href="/latest/">Blog</a><div class="navbar-separator"></div><a class="nav-link" href="/about/">About</a></div></nav><div class="root-wrapper expand-height"><div class="text-light large" style="background-color:black;margin:0;padding:15px;padding-left:30px;padding-right:30px"><p style="text-align:center;margin:0"><b>Black Lives Matter.</b> Please consider donating to the<!-- --> <a href="https://www.paypal.me/SLOBailFund">San Luis Obispo, CA Bail Fund</a> <!-- -->or <a href="https://bailfunds.github.io">other bail funds</a> so we can make the world a just and equitable place for all people of all colors.</p></div><div style="background-color:#b3c1e6"><nav class="page-heading_above__2RV0m"></nav><header class="page-heading_header__zwjn1"><h1>Down-shifting and filtering a signal</h1><p>Because the FPGA is fast, but not *that* fast</p></header></div><div class="longform-layout_container__1bKFt container"><div class="row"><div class="longform-layout_content__gfokN col-lg-8"><article class="longform"><article class="longform"><div><h2 id="introduction">Introduction</h2>
<p>When I was taking Computer Architecture, I needed an FPGA for the class,
and a <a href="https://store.digilentinc.com/basys-3-artix-7-fpga-trainer-board-recommended-for-introductory-users/">Basys 3</a>
in particular. In any other year, I would have probably borrowed it
from Cal Poly to take computer architecture. However,
due to the pandemic, I had to spend money and buy it myself.
That thing is $150 - it ain’t cheap!</p>
<p>Now that class is over, I had this board and I wanted to do
something with it. I didn’t want to do something that any
ordinary microcontroller could do because that’s boring, in that case I would
just use a microcontroller. No, I wanted to make something that
<em>requires</em> a FPGA.</p>
<p>So, I thought of making a direct sampling software-defined
radio. It won’t have a transmit function, only a receive
function, because I have no idea how to do power electronics.
Its main purpose would be basically as an ultra
wide band scanner (I’m thinking of trying to make it scan
a 50 MHz section all at once).</p>
<h2 id="problem-parameters">Problem parameters</h2>
<p>The FPGA has a <strong>100 MHz internal clock</strong> for most computations, and I
want to scan the spectrum of frequencies <strong>between 125 and 175 MHz.</strong>
Therefore, by the Nyquist-Shannon theorem, I will need at least
twice that - 325 MSPS (million samples per second) coming in.</p>
<p>I’ve figured out a possible way to get <strong>400 MSPS at an 8 bit
resolution</strong> into the FPGA. This involves going above 100 MHz, and
this will likely be elaborated on in the future. But for now, we’ll just
assume for now that that’s the data stream coming in. So, every 100 MHz
clock, we get 4 x 8-bit samples. We are dealing with a theoretical
data rate of 3.2 Gbps, and <em>this</em> is why we need an FPGA.</p>
<h2 id="generating-a-raw-signal">Generating a “raw signal”</h2>
<p>Let’s make a signal with lots of different frequency components that we can use for experimenting with. It should reveal why we need to pre-process the signal before FFT.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt


<span class="token comment"># Configuration so that y&#x27;all actually see this stuff</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">&#x27;figure.figsize&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>

M_SAMPLES_PER_SECOND <span class="token operator">=</span> <span class="token number">400</span>
SAMPLES_PER_SECOND <span class="token operator">=</span> M_SAMPLES_PER_SECOND <span class="token operator">*</span> <span class="token number">1e6</span>
NYQUIST <span class="token operator">=</span> SAMPLES_PER_SECOND <span class="token operator">/</span> <span class="token number">2</span>
SIGNAL_LENGTH <span class="token operator">=</span> <span class="token number">10e</span><span class="token operator">-</span><span class="token number">3</span>
FFT_SIZE <span class="token operator">=</span> <span class="token number">4096</span>

<span class="token comment"># Time domain (1 index = 1 sample at 400 MSPS)</span>
time <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SIGNAL_LENGTH<span class="token punctuation">,</span> SIGNAL_LENGTH <span class="token operator">*</span> SAMPLES_PER_SECOND<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">tone</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x <span class="token operator">*</span> time <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">fm_tone</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> carrier<span class="token punctuation">,</span> deviation<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>carrier <span class="token operator">*</span> time <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">+</span> deviation <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x <span class="token operator">*</span> time <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">am_tone</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> carrier<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x <span class="token operator">*</span> time <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>carrier <span class="token operator">*</span> time <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>

received_signal <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> tone<span class="token punctuation">(</span><span class="token number">125e6</span><span class="token punctuation">)</span>
received_signal <span class="token operator">+=</span> <span class="token number">5</span> <span class="token operator">*</span> tone<span class="token punctuation">(</span><span class="token number">175e6</span><span class="token punctuation">)</span>
received_signal <span class="token operator">+=</span> <span class="token number">10</span> <span class="token operator">*</span> am_tone<span class="token punctuation">(</span><span class="token number">5e3</span><span class="token punctuation">,</span> <span class="token number">150e6</span><span class="token punctuation">)</span>
received_signal <span class="token operator">+=</span> fm_tone<span class="token punctuation">(</span><span class="token number">100e3</span><span class="token punctuation">,</span> <span class="token number">135e6</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span>

<span class="token comment"># Add in some unwanted tones</span>
received_signal <span class="token operator">+=</span> <span class="token number">5</span> <span class="token operator">*</span> tone<span class="token punctuation">(</span><span class="token number">100e6</span><span class="token punctuation">)</span>
received_signal <span class="token operator">+=</span> <span class="token number">100</span> <span class="token operator">*</span> tone<span class="token punctuation">(</span><span class="token number">120e6</span><span class="token punctuation">)</span>
received_signal <span class="token operator">+=</span> <span class="token number">0.5</span> <span class="token operator">*</span> fm_tone<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">180e6</span><span class="token punctuation">,</span> <span class="token number">4e3</span><span class="token punctuation">)</span>
received_signal <span class="token operator">+=</span> <span class="token number">4</span> <span class="token operator">*</span> fm_tone<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">50e6</span><span class="token punctuation">,</span> <span class="token number">1e5</span><span class="token punctuation">)</span>

<span class="token comment"># An increasing frequency tone to act as an indicator</span>
received_signal <span class="token operator">+=</span> <span class="token number">3</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token punctuation">(</span>time <span class="token operator">*</span> <span class="token number">100e6</span> <span class="token operator">/</span> SIGNAL_LENGTH<span class="token punctuation">)</span> <span class="token operator">*</span> time <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>

<span class="token comment"># Add in some noise for the heck of it</span>
received_signal <span class="token operator">+=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span>

bin_size_0 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> M_SAMPLES_PER_SECOND <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">/</span> FFT_SIZE

plt<span class="token punctuation">.</span>specgram<span class="token punctuation">(</span>received_signal<span class="token punctuation">,</span> FFT_SIZE<span class="token punctuation">,</span> M_SAMPLES_PER_SECOND<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;Bin size: </span><span class="token interpolation"><span class="token punctuation">{</span>bin_size_0<span class="token punctuation">:</span><span class="token format-spec">02.3f</span><span class="token punctuation">}</span></span><span class="token string"> kHz&#x27;</span></span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Full signal (</span><span class="token interpolation"><span class="token punctuation">{</span>bin_size_0<span class="token punctuation">:</span><span class="token format-spec">02.3f</span><span class="token punctuation">}</span></span><span class="token string"> kHz bins)&quot;</span></span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;time (us)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">Bin size: 48.828 kHz</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_1_1.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_1_1.png" alt="png" width="1200"/></a>
<p>Once again, we only care about the 125-175MHz range! We don’t care about anything outside of that! So, all those wonky sine waves I added in are essentially junk data.</p>
<p>Notice that the bin size is 50 kHz. Extremely thick.
Narrowband FM on a Baofeng UV-5R is 12.5kHz, and it’s likely even smaller for other radios.
We won’t be able to see individual channels, just a group of 4 channels or more.</p>
<p>This is the motivation behind preprocessing the signal. We want to essentially zoom in
on the 125-175MHz range so that our FFT can be much more precise for the same amount of
computation.</p>
<h2 id="shifting-the-signal-downwards">Shifting the signal downwards</h2>
<h3 id="bandpass">Bandpass</h3>
<p>First, we apply a bandpass filter with cutoffs at 120MHz and 180MHz. They
are somewhat offset from the frequencies we want so that we have a little
buffer space at the ends.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> scipy <span class="token keyword">import</span> signal

bp_filter <span class="token operator">=</span> signal<span class="token punctuation">.</span>butter<span class="token punctuation">(</span>
    <span class="token number">32</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">120e6</span> <span class="token operator">/</span> NYQUIST<span class="token punctuation">,</span> <span class="token number">180e6</span> <span class="token operator">/</span> NYQUIST<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&#x27;band&#x27;</span><span class="token punctuation">,</span>
    analog<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
    output<span class="token operator">=</span><span class="token string">&#x27;sos&#x27;</span>
<span class="token punctuation">)</span>
w<span class="token punctuation">,</span> h <span class="token operator">=</span> signal<span class="token punctuation">.</span>sosfreqz<span class="token punctuation">(</span>bp_filter<span class="token punctuation">,</span> fs<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log10<span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Frequency response of the bandpass filter&quot;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;response (dB)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_3_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_3_0.png" alt="png" width="1200"/></a>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">bp_sig <span class="token operator">=</span> signal<span class="token punctuation">.</span>sosfilt<span class="token punctuation">(</span>bp_filter<span class="token punctuation">,</span> received_signal<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>specgram<span class="token punctuation">(</span>bp_sig<span class="token punctuation">,</span> FFT_SIZE<span class="token punctuation">,</span> M_SAMPLES_PER_SECOND<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Post-Bandpass Signal&quot;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;time (us)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_4_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_4_0.png" alt="png" width="1200"/></a>
<h3 id="mixing-for-shifting">Mixing for Shifting</h3>
<p>Next, we mix with a 115MHz signal. For a signal with frequency <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span></span>, this should
produce two signals, one at <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>−</mo><mn>115</mn><mtext>MHz</mtext></mrow><annotation encoding="application/x-tex">f - 115\text{MHz}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord">115</span><span class="mord text"><span class="mord">MHz</span></span></span></span></span></span>, and the other reflected
at <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>115</mn><mtext>MHz</mtext><mo>−</mo><mo stretchy="false">(</mo><mi>f</mi><mo>−</mo><mn>115</mn><mtext>MHz</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">115\text{MHz} - (f - 115\text{MHz})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em"></span><span class="mord">115</span><span class="mord text"><span class="mord">MHz</span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">115</span><span class="mord text"><span class="mord">MHz</span></span><span class="mclose">)</span></span></span></span></span>.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">mixed <span class="token operator">=</span> bp_sig <span class="token operator">*</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">115e6</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> time<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>specgram<span class="token punctuation">(</span>mixed<span class="token punctuation">,</span> FFT_SIZE<span class="token punctuation">,</span> M_SAMPLES_PER_SECOND<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Post-mixing signal&quot;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;time (us)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_6_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_6_0.png" alt="png" width="1200"/></a>
<h3 id="lowpass">Lowpass</h3>
<p>We now perform a low pass to keep the low-frequency signal and get rid of its evil high-frequency twin.
The 10-60MHz range here is the equivalent of the original’s 125-175MHz range, so we’ll do a 65MHz
lowpass.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">lp_filter <span class="token operator">=</span> signal<span class="token punctuation">.</span>butter<span class="token punctuation">(</span>
    <span class="token number">27</span><span class="token punctuation">,</span>
    <span class="token number">65e6</span> <span class="token operator">/</span> NYQUIST<span class="token punctuation">,</span>
    <span class="token string">&#x27;lowpass&#x27;</span><span class="token punctuation">,</span>
    output<span class="token operator">=</span><span class="token string">&#x27;sos&#x27;</span>
<span class="token punctuation">)</span>
w<span class="token punctuation">,</span> h <span class="token operator">=</span> signal<span class="token punctuation">.</span>sosfreqz<span class="token punctuation">(</span>lp_filter<span class="token punctuation">,</span> fs<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log10<span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Frequency response of the lowpass filter&quot;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;response (dB)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_8_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_8_0.png" alt="png" width="1200"/></a>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">lp_sig <span class="token operator">=</span> signal<span class="token punctuation">.</span>sosfilt<span class="token punctuation">(</span>lp_filter<span class="token punctuation">,</span> mixed<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>specgram<span class="token punctuation">(</span>lp_sig<span class="token punctuation">,</span> FFT_SIZE<span class="token punctuation">,</span> M_SAMPLES_PER_SECOND<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Post-lowpass signal&quot;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;time (us)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_9_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_9_0.png" alt="png" width="1200"/></a>
<h3 id="decimation">Decimation</h3>
<p>Finally, we decimate to get rid of what we don’t want. Decimating by a
factor of 3 means that the frequencies included here are between 0-67MHz
post-mixing, which is 120-177MHz on the original.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">decimate <span class="token operator">=</span> signal<span class="token punctuation">.</span>decimate<span class="token punctuation">(</span>lp_sig<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
bin_size_1 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token punctuation">(</span>M_SAMPLES_PER_SECOND <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">/</span> FFT_SIZE

plt<span class="token punctuation">.</span>specgram<span class="token punctuation">(</span>decimate<span class="token punctuation">,</span> FFT_SIZE<span class="token punctuation">,</span> M_SAMPLES_PER_SECOND <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Post-decimate signal (</span><span class="token interpolation"><span class="token punctuation">{</span>bin_size_1<span class="token punctuation">:</span><span class="token format-spec">02.3f</span><span class="token punctuation">}</span></span><span class="token string"> kHz)&quot;</span></span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;time (us)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;Bin size (no pre-processing): </span><span class="token interpolation"><span class="token punctuation">{</span>bin_size_0<span class="token punctuation">}</span></span><span class="token string"> kHz&#x27;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#x27;Bin size (with pre-processing): </span><span class="token interpolation"><span class="token punctuation">{</span>bin_size_1<span class="token punctuation">:</span><span class="token format-spec">02.3f</span><span class="token punctuation">}</span></span><span class="token string"> kHz&#x27;</span></span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_11_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_11_0.png" alt="png" width="1200"/></a>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">Bin size (no pre-processing): 48.828125 kHz
Bin size (with pre-processing): 16.276 kHz</code></pre></div>
<h3 id="cutting-off-the-edges">Cutting off the edges</h3>
<p>You can see how the sub-120 MHz signals get aliased in by the “checkmark”
over the 1500 tick. This is why we want padding below 125MHz and above
175MHz. However, the aliasing stays below 10 MHz on this spectrogram (125 MHz
on the original). So, we’ll just zoom in on the center and pretend the
upper and lower bands don’t exist and pretend the
axes are the correct “original” values.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">plt<span class="token punctuation">.</span>specgram<span class="token punctuation">(</span>decimate<span class="token punctuation">,</span> FFT_SIZE<span class="token punctuation">,</span> M_SAMPLES_PER_SECOND <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Final signal that we will use&quot;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#x27;frequency (MHz)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#x27;time (us)&#x27;</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<a href="/_/2020/06/18/freq-shift_files/freq-shift_13_0.png"><img src="/_/2020/06/18/freq-shift_files/freq-shift_13_0.png" alt="png" width="1200"/></a>
<h2 id="conclusion">Conclusion</h2>
<p>In this post we have designed a method of pre-processing a signal so that performing a FFT on it later will be more precise and have smaller bins. If I continue working on this project, I’ll post updates and make a project page for it.</p>
<h2 id="license">License</h2>
<p>Copyright (c) 2020 Astrid Yu. This code is licensed under <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">GNU AGPL</a>.</p></div></article></article></div><div class="col-lg-4"><div class="longform-layout_sidebarGroup__1maJR"><table style="width:100%"><tbody><tr><th style="min-width:180px"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg> <!-- -->Date</th><td class="longform-layout_statusData__1GlEa">18 Jun 2020</td></tr></tbody></table></div><div class="longform-layout_sidebarGroup__1maJR"><h2>Tags</h2><div><p style="font-size:12pt;margin-bottom:3px"><a href="/t/computer-engineering"><span style="background-color:#d13b00;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">computer-engineering</span></a><a href="/t/dsp"><span style="background-color:#1a71ff;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">dsp</span></a><a href="/t/fpgas"><span style="background-color:#6dff1f;color:#000000;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">fpgas</span></a><a href="/t/jupyter"><span style="background-color:#EB7325;color:#000000;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Jupyter</span></a><a href="/t/math"><span style="background-color:#ff0066;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Math</span></a><a href="/t/matplotlib"><span style="background-color:#FFFFFF;color:#11557C;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Matplotlib</span></a><a href="/t/notes"><span style="background-color:#fa7d00;color:#000000;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">notes</span></a><a href="/t/numpy"><span style="background-color:#3D84C6;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Numpy</span></a><a href="/t/python"><span style="background-color:#3572A5;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Python</span></a><a href="/t/scikit-learn"><span style="background-color:#f89939;color:#000000;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Scikit-Learn</span></a> </p></div></div></div></div></div><div class="container"><section id="comments"><h2>Comments</h2><div class="comments"><div><form class=""><div class="row form-group"><label for="comment-name" class="col-sm-4 col-form-label">Name (leave blank for anonymous)</label><div class="col-sm-8"><input type="text" name="name" id="comment-name" placeholder="Willy Shakespeare" class="form-control"/></div></div><div class="row form-group"><label for="comment-email" class="col-sm-4 col-form-label">Email (required)</label><div class="col-sm-8"><input type="email" name="email" id="comment-email" placeholder="user@example.com" class="form-control"/></div></div><div class="row form-group"><label for="comment-website" class="col-sm-4 col-form-label">Website</label><div class="col-sm-8"><input type="url" name="website" id="comment-website" placeholder="my.cool.site" class="form-control"/></div></div><div class="form-group"><label for="comment-body" class="">Comment (<!-- -->1000<!-- --> chars left)</label><textarea name="body" id="comment-body" placeholder="Type your comment here..." class="form-control"></textarea><small class="form-text text-muted">Markdown formatting is supported.</small></div><div class="row"><button type="button" class="btn btn-primary">Submit!</button></div></form></div></div></section></div></div><footer class="footer_footer__1KZqX"><div class="text-light small container"><div class="col"><nav class="row"><div class="col-6 col-sm-4"><a href="/privacy/">Privacy Policy</a></div><div class="col-6 col-sm-4"><a href="/licenses/">Open Source Licenses</a></div><div class="col-6 col-sm-4"><a href="/about/">About/Contact</a></div></nav></div><div class="col"><p>astrid.tech v<!-- -->2.0.0<!-- --> was created by Astrid Yu with a generous helping of <span title="tea" aria-label="tea" role="img">☕</span> and <span title="witchcraft" aria-label="witchcraft" role="img">🧙‍</span>. See the<!-- --> <a href="/projects/astrid-tech/">self-referential project page</a> <!-- -->or see the code yourself on<!-- --> <a href="https://github.com/astralbijection/astrid.tech">GitHub</a>.</p></div><div class="row"><div class="col"></div></div><div class="row"><div class="text-center col"><a href="https://www.gnu.org/licenses/agpl-3.0.en.html"><img alt="GNU Affero General Public License" width="100" height="40" src="/agpl.png"/></a><p><a href="https://github.com/astralbijection/astrid.tech">The source code of astrid.tech</a> <!-- -->is licensed under the<!-- --> <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">AGPL License</a>.<!-- --> </p></div><div class="text-center col"><p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a><br/><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">The page content of astrid.tech</span> <!-- -->by<!-- --> <a xmlns:cc="http://creativecommons.org/ns#" href="https://astrid.tech" property="cc:attributionName" rel="cc:attributionURL">Astrid Yu</a> <!-- -->is licensed under a<!-- --> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":18,"assetRoot":"2020/06/18","thumbnail":null,"title":"Down-shifting and filtering a signal","description":"Because the FPGA is fast, but not *that* fast","slug":"freq-shift","date":"2020-06-18T00:00:00.000Z","content":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen I was taking Computer Architecture, I needed an FPGA for the class,\nand a \u003ca href=\"https://store.digilentinc.com/basys-3-artix-7-fpga-trainer-board-recommended-for-introductory-users/\"\u003eBasys 3\u003c/a\u003e\nin particular. In any other year, I would have probably borrowed it\nfrom Cal Poly to take computer architecture. However,\ndue to the pandemic, I had to spend money and buy it myself.\nThat thing is $150 - it ain’t cheap!\u003c/p\u003e\n\u003cp\u003eNow that class is over, I had this board and I wanted to do\nsomething with it. I didn’t want to do something that any\nordinary microcontroller could do because that’s boring, in that case I would\njust use a microcontroller. No, I wanted to make something that\n\u003cem\u003erequires\u003c/em\u003e a FPGA.\u003c/p\u003e\n\u003cp\u003eSo, I thought of making a direct sampling software-defined\nradio. It won’t have a transmit function, only a receive\nfunction, because I have no idea how to do power electronics.\nIts main purpose would be basically as an ultra\nwide band scanner (I’m thinking of trying to make it scan\na 50 MHz section all at once).\u003c/p\u003e\n\u003ch2 id=\"problem-parameters\"\u003eProblem parameters\u003c/h2\u003e\n\u003cp\u003eThe FPGA has a \u003cstrong\u003e100 MHz internal clock\u003c/strong\u003e for most computations, and I\nwant to scan the spectrum of frequencies \u003cstrong\u003ebetween 125 and 175 MHz.\u003c/strong\u003e\nTherefore, by the Nyquist-Shannon theorem, I will need at least\ntwice that - 325 MSPS (million samples per second) coming in.\u003c/p\u003e\n\u003cp\u003eI’ve figured out a possible way to get \u003cstrong\u003e400 MSPS at an 8 bit\nresolution\u003c/strong\u003e into the FPGA. This involves going above 100 MHz, and\nthis will likely be elaborated on in the future. But for now, we’ll just\nassume for now that that’s the data stream coming in. So, every 100 MHz\nclock, we get 4 x 8-bit samples. We are dealing with a theoretical\ndata rate of 3.2 Gbps, and \u003cem\u003ethis\u003c/em\u003e is why we need an FPGA.\u003c/p\u003e\n\u003ch2 id=\"generating-a-raw-signal\"\u003eGenerating a “raw signal”\u003c/h2\u003e\n\u003cp\u003eLet’s make a signal with lots of different frequency components that we can use for experimenting with. It should reveal why we need to pre-process the signal before FFT.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e np\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e matplotlib\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epyplot \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e plt\n\n\n\u003cspan class=\"token comment\"\u003e# Configuration so that y'all actually see this stuff\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ercParams\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'figure.figsize'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e11\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e7\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\nM_SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e400\u003c/span\u003e\nSAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e M_SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e1e6\u003c/span\u003e\nNYQUIST \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\nSIGNAL_LENGTH \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e10e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\nFFT_SIZE \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e4096\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Time domain (1 index = 1 sample at 400 MSPS)\u003c/span\u003e\ntime \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinspace\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e SIGNAL_LENGTH\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e SIGNAL_LENGTH \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e SAMPLES_PER_SECOND\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003efm_tone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e carrier\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e deviation\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecarrier \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e deviation \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eam_tone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e carrier\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecarrier \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nreceived_signal \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e125e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e175e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e am_tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e150e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e fm_tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e100e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e135e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.25\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Add in some unwanted tones\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e100e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e120e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e fm_tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e800\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e180e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e4e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e fm_tone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e250\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e50e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# An increasing frequency tone to act as an indicator\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etime \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e100e6\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e SIGNAL_LENGTH\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Add in some noise for the heck of it\u003c/span\u003e\nreceived_signal \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erandom\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enormal\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nbin_size_0 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e M_SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e FFT_SIZE\n\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003especgram\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereceived_signal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e FFT_SIZE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e M_SAMPLES_PER_SECOND\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef'Bin size: \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ebin_size_0\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token format-spec\"\u003e02.3f\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e kHz'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"Full signal (\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ebin_size_0\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token format-spec\"\u003e02.3f\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e kHz bins)\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time (us)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eBin size: 48.828 kHz\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_1_1.png\" alt=\"png\"\u003e\n\u003cp\u003eOnce again, we only care about the 125-175MHz range! We don’t care about anything outside of that! So, all those wonky sine waves I added in are essentially junk data.\u003c/p\u003e\n\u003cp\u003eNotice that the bin size is 50 kHz. Extremely thick.\nNarrowband FM on a Baofeng UV-5R is 12.5kHz, and it’s likely even smaller for other radios.\nWe won’t be able to see individual channels, just a group of 4 channels or more.\u003c/p\u003e\n\u003cp\u003eThis is the motivation behind preprocessing the signal. We want to essentially zoom in\non the 125-175MHz range so that our FFT can be much more precise for the same amount of\ncomputation.\u003c/p\u003e\n\u003ch2 id=\"shifting-the-signal-downwards\"\u003eShifting the signal downwards\u003c/h2\u003e\n\u003ch3 id=\"bandpass\"\u003eBandpass\u003c/h3\u003e\n\u003cp\u003eFirst, we apply a bandpass filter with cutoffs at 120MHz and 180MHz. They\nare somewhat offset from the frequencies we want so that we have a little\nbuffer space at the ends.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e scipy \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e signal\n\nbp_filter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebutter\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token number\"\u003e32\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e120e6\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e NYQUIST\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e180e6\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e NYQUIST\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e'band'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    analog\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sos'\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nw\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e h \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esosfreqz\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebp_filter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fs\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e400\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eplot\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e20\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elog10\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eabs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eh\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Frequency response of the bandpass filter\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'response (dB)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_3_0.png\" alt=\"png\"\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003ebp_sig \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esosfilt\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebp_filter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e received_signal\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003especgram\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebp_sig\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e FFT_SIZE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e M_SAMPLES_PER_SECOND\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Post-Bandpass Signal\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time (us)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_4_0.png\" alt=\"png\"\u003e\n\u003ch3 id=\"mixing-for-shifting\"\u003eMixing for Shifting\u003c/h3\u003e\n\u003cp\u003eNext, we mix with a 115MHz signal. For a signal with frequency \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ef\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, this should\nproduce two signals, one at \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e115\u003c/mn\u003e\u003cmtext\u003eMHz\u003c/mtext\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef - 115\\text{MHz}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e115\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMHz\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, and the other reflected\nat \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e115\u003c/mn\u003e\u003cmtext\u003eMHz\u003c/mtext\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e115\u003c/mn\u003e\u003cmtext\u003eMHz\u003c/mtext\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e115\\text{MHz} - (f - 115\\text{MHz})\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e115\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMHz\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e115\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMHz\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003emixed \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e bp_sig \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e115e6\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003especgram\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emixed\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e FFT_SIZE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e M_SAMPLES_PER_SECOND\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Post-mixing signal\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time (us)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_6_0.png\" alt=\"png\"\u003e\n\u003ch3 id=\"lowpass\"\u003eLowpass\u003c/h3\u003e\n\u003cp\u003eWe now perform a low pass to keep the low-frequency signal and get rid of its evil high-frequency twin.\nThe 10-60MHz range here is the equivalent of the original’s 125-175MHz range, so we’ll do a 65MHz\nlowpass.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003elp_filter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebutter\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token number\"\u003e27\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token number\"\u003e65e6\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e NYQUIST\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e'lowpass'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sos'\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nw\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e h \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esosfreqz\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elp_filter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fs\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e400\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eplot\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e20\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elog10\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eabs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eh\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Frequency response of the lowpass filter\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'response (dB)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_8_0.png\" alt=\"png\"\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003elp_sig \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esosfilt\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elp_filter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mixed\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003especgram\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elp_sig\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e FFT_SIZE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e M_SAMPLES_PER_SECOND\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Post-lowpass signal\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time (us)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_9_0.png\" alt=\"png\"\u003e\n\u003ch3 id=\"decimation\"\u003eDecimation\u003c/h3\u003e\n\u003cp\u003eFinally, we decimate to get rid of what we don’t want. Decimating by a\nfactor of 3 means that the frequencies included here are between 0-67MHz\npost-mixing, which is 120-177MHz on the original.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003edecimate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e signal\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edecimate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elp_sig\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nbin_size_1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eM_SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e FFT_SIZE\n\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003especgram\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edecimate\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e FFT_SIZE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e M_SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"Post-decimate signal (\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ebin_size_1\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token format-spec\"\u003e02.3f\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e kHz)\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time (us)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef'Bin size (no pre-processing): \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ebin_size_0\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e kHz'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef'Bin size (with pre-processing): \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ebin_size_1\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token format-spec\"\u003e02.3f\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e kHz'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_11_0.png\" alt=\"png\"\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eBin size (no pre-processing): 48.828125 kHz\nBin size (with pre-processing): 16.276 kHz\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"cutting-off-the-edges\"\u003eCutting off the edges\u003c/h3\u003e\n\u003cp\u003eYou can see how the sub-120 MHz signals get aliased in by the “checkmark”\nover the 1500 tick. This is why we want padding below 125MHz and above\n175MHz. However, the aliasing stays below 10 MHz on this spectrogram (125 MHz\non the original). So, we’ll just zoom in on the center and pretend the\nupper and lower bands don’t exist and pretend the\naxes are the correct “original” values.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003eplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003especgram\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edecimate\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e FFT_SIZE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e M_SAMPLES_PER_SECOND \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylim\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Final signal that we will use\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eylabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'frequency (MHz)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exlabel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'time (us)'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nplt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cimg src=\"/_/2020/06/18/freq-shift_files/freq-shift_13_0.png\" alt=\"png\"\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eIn this post we have designed a method of pre-processing a signal so that performing a FFT on it later will be more precise and have smaller bins. If I continue working on this project, I’ll post updates and make a project page for it.\u003c/p\u003e\n\u003ch2 id=\"license\"\u003eLicense\u003c/h2\u003e\n\u003cp\u003eCopyright (c) 2020 Astrid Yu. This code is licensed under \u003ca href=\"https://www.gnu.org/licenses/agpl-3.0.en.html\"\u003eGNU AGPL\u003c/a\u003e.\u003c/p\u003e","tags":["computer-engineering","dsp","fpgas","jupyter","math","matplotlib","notes","numpy","python","scikit-learn"]}},"__N_SSG":true},"page":"/[year]/[month]/[day]/[...slug]","query":{"year":"2020","month":"06","day":"18","slug":["freq-shift"]},"buildId":"xu5MpDjzYRyNj4te1Gtrv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>