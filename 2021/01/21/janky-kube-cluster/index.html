<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link title="astrid.tech RSS" rel="alternate" type="application/rss+xml" href="https://astrid.tech/rss.xml"/><link title="astrid.tech Atom" rel="alternate" type="application/atom+xml" href="https://astrid.tech/atom.xml"/><link title="astrid.tech JSON feed" rel="alternate" type="application/feed+json" href="https://astrid.tech/feed.json"/><link href="https://github.com/astralbijection" rel="me authn"/><link href="mailto:astrid@astrid.tech" rel="me"/><title>A Kubernetes cluster but it&#x27;s only made of used computers | astrid.tech</title><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="description" content="16-year-old me would be proud"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="astralbijection"/><meta name="twitter:title" content="A Kubernetes cluster but it&#x27;s only made of used computers"/><meta name="twitter:description" content="16-year-old me would be proud"/><meta property="og:title" content="A Kubernetes cluster but it&#x27;s only made of used computers"/><meta property="og:description" content="16-year-old me would be proud"/><meta property="og:type" content="website"/><meta name="robots" content="follow,index"/><meta property="og:url" content="https:/astrid.tech/2021/01/21/janky-kube-cluster"/><link title="astrid.tech RSS" rel="alternate" type="application/rss+xml" href="https://astrid.tech/rss.xml"/><link title="astrid.tech Atom" rel="alternate" type="application/atom+xml" href="https://astrid.tech/atom.xml"/><link title="astrid.tech JSON feed" rel="alternate" type="application/feed+json" href="https://astrid.tech/feed.json"/><link href="https://github.com/astralbijection" rel="me authn"/><link href="mailto:astrid@astrid.tech" rel="me"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/1d0d198a1c5bdedcad14.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1d0d198a1c5bdedcad14.css" data-n-g=""/><link rel="preload" href="/_next/static/css/bd89e56ee668535d8996.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bd89e56ee668535d8996.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-e7a279300235e161e32a.js"></script><script src="/_next/static/chunks/webpack-3071412ed8bc8fc49fc7.js" defer=""></script><script src="/_next/static/chunks/framework-2f612445bd50b211f15a.js" defer=""></script><script src="/_next/static/chunks/main-6bd02c179f9e0ec2bd5a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1658794de36b29c002aa.js" defer=""></script><script src="/_next/static/chunks/545f34e4-37710c009d2bbbd273c3.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-571001351e1ed221a25c.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-fc4f6c929a53a9b582f6.js" defer=""></script><script src="/_next/static/chunks/398-1b9f48eb99654eeda62b.js" defer=""></script><script src="/_next/static/chunks/264-b52c4cdeb9e69930784f.js" defer=""></script><script src="/_next/static/chunks/146-41f4f1c63257555b1b33.js" defer=""></script><script src="/_next/static/chunks/993-2df73c7cf8296f032349.js" defer=""></script><script src="/_next/static/chunks/705-c9d82552f3ea55b2fe7a.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5B...slug%5D-e11dd750811444406993.js" defer=""></script><script src="/_next/static/xu5MpDjzYRyNj4te1Gtrv/_buildManifest.js" defer=""></script><script src="/_next/static/xu5MpDjzYRyNj4te1Gtrv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="main-navbar navbar navbar-expand-md fixed-top"><a href="/" class="nav-link navbar-brand">astrid.tech</a><button aria-label="Toggle navigation" type="button" class="navbar-toggler"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M250.97 29.357c-106.557-.21-211.806 52.74-203.48 164.053 138.91 11.4 276.71 8.893 414.174.662 10.58-107.69-100.753-164.498-210.693-164.715zm59.876 23.996c11.165 0 20.216 4.468 20.216 9.98 0 5.513-9.051 9.981-20.216 9.981-11.166 0-20.217-4.468-20.217-9.98 0-5.513 9.051-9.98 20.217-9.98zm-111.852 19.83c11.165 0 20.217 4.469 20.217 9.98 0 5.513-9.052 9.981-20.217 9.981s-20.216-4.468-20.217-9.98c0-5.512 9.052-9.98 20.217-9.98zm178.057 34.02c11.165 0 20.216 4.468 20.217 9.98 0 5.512-9.052 9.98-20.217 9.98s-20.217-4.468-20.217-9.98c0-5.512 9.052-9.98 20.217-9.98zm-273.59 21.535c11.165 0 20.216 4.468 20.217 9.98 0 5.513-9.052 9.98-20.217 9.98s-20.217-4.467-20.217-9.98c0-5.512 9.052-9.98 20.217-9.98zm313.77 30.043c11.165 0 20.216 4.468 20.216 9.98 0 5.512-9.051 9.98-20.217 9.98-11.165 0-20.216-4.468-20.216-9.98 0-5.512 9.051-9.98 20.216-9.98zm-137.91 8.045c11.166 0 20.218 4.47 20.216 9.982 0 5.512-9.051 9.98-20.217 9.98-11.165 0-20.216-4.468-20.216-9.98-.002-5.513 9.05-9.982 20.216-9.982zM57.618 212.339c-18.964.405-9.028 24.485 14.383 24.573 128.554 10.208 236.673 9.686 372.117-2.42 16.096-2.708 25.212-13.087 10.824-21.969-131.579 7.67-263.81 10.045-397.324-.184zm403.024 40.612c-131.224 13.6-277.594 10.525-390.065 1.904-46.983-6.226-47.875 46.785-17.014 52.309 146.18 14.663 271.826 10.735 415.137-.53 25.007-1.144 14.554-55.328-8.058-53.683zM20.986 366.679l15.332 9.434c6.342-8.416 17.876-32.05 33.319-32.192 19.122-.174 22.345 39.302 41.98 39.103 22.607-.228 37.828-31.548 52.447-30.882 22.09 1.008 26.333 35.9 43.557 35.928 24.089.04 31.439-36.39 46.805-35.334 21.458 1.475 33.246 28.274 50.879 29.178 19.004.974 30.654-33.027 43.265-32.748 16.61.366 28.31 32.46 54.24 33.193 15.345.434 29.694-37.411 37.005-36.815 14.417 1.174 26.549 20.548 36.085 34.835l15.114-9.776c-12.029-16.216-30.117-44.428-52.558-44.017-20.907.382-25.948 38.114-38.102 37.943-23.28-.328-33.756-32.164-52.598-33.346-19.356-1.214-30.475 33.636-43.353 32.768-18.954-1.277-27.303-29.16-49.475-29.917-19.62-.67-34.121 37.669-46.793 36.044-18.139-2.326-20.226-36.378-43.317-37.836-19.11-1.207-37.562 30.604-50.314 29.999-17.525-.833-25.243-40.224-45.41-39.986-21.826.258-39.145 30.34-48.108 44.424zm47.553 36.174c-8.342.686-18.198 4.251-21.85 12.424-2.452 6.662 19.173 8.558 21.114 8.695 128.615 8.104 254.354 8.26 389.8-1.345 9.225-.655 13.935-3.147 15.252-4.414 3.124-8.208-23.168-13.935-25.818-14.004-185.01-1.178-279.257 2.209-378.498-1.356zm395.555 37.192c-126.786 6.957-283.18 9.384-408.123.707l.521 38.67c135.917 4.617 275.647 3.99 406.658-.088z"></path></svg></button><div class="collapse navbar-collapse"><a class="nav-link" href="/projects/">Projects</a><a class="nav-link active" href="/latest/">Blog</a><div class="navbar-separator"></div><a class="nav-link" href="/about/">About</a></div></nav><div class="root-wrapper expand-height"><div class="text-light large" style="background-color:black;margin:0;padding:15px;padding-left:30px;padding-right:30px"><p style="text-align:center;margin:0"><b>Black Lives Matter.</b> Please consider donating to the<!-- --> <a href="https://www.paypal.me/SLOBailFund">San Luis Obispo, CA Bail Fund</a> <!-- -->or <a href="https://bailfunds.github.io">other bail funds</a> so we can make the world a just and equitable place for all people of all colors.</p></div><div style="background-color:#b3e6d0"><nav class="page-heading_above__2RV0m"></nav><header class="page-heading_header__zwjn1"><h1>A Kubernetes cluster but it&#x27;s only made of used computers</h1><p>16-year-old me would be proud</p></header></div><div class="longform-layout_container__1bKFt container"><div class="row"><div class="longform-layout_content__gfokN col-lg-8"><article class="longform"><article class="longform"><div><p>In <a href="/2021/01/18/selfhost/">my last post</a> had 7 things I wanted to do. Well, here‚Äôs a summary of everything I did so far. The <a href="https://github.com/astralbijection/astrid.tech-deployment">IaC repo is here</a> and the last commit before I published this article was <a href="https://github.com/astralbijection/astrid.tech-deployment/tree/d18736ae4cf926c177488a07565521328ba09aee">d18736</a>.</p>
<p>EDIT: It has come to my attention that I‚Äôm missing a picture. Anyways, here‚Äôs what the cluster looks like.</p>
<a href="/_/2021/01/21/janky-kube-cluster/cluster.jpeg"><img src="/_/2021/01/21/janky-kube-cluster/cluster.jpeg" alt="Hello from CyberCthulu" width="1200"/></a>
<h2 id="monday-118-setting-up-k8s-and-an-elastic-stack">Monday 1/18: Setting up k8s and an Elastic stack</h2>
<p>I woke up awfully early that morning at 5 AM, way earlier than I usually wake up. It was MLK day, so I didn‚Äôt have classes, and so I decided to spend the day setting up Kubernetes. I started out with 2 machines, both running Debian Buster Stable:</p>
<ul>
<li>The HP Pavilion x360 laptop with a cracked screen that I used to use before the screen cracked (named <code>cracktop</code>)</li>
<li>An old Dell Optiplex workstation (that STILL RUNS DDR2 mind you) I got off of eBay a few years ago for doing something similar (named <code>deskrap</code>)</li>
</ul>
<p>I basically spent from 5 AM until 9 PM trying to set up k8s<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> the Proper Way ‚Ñ¢Ô∏è on those two machines and it was painful and it didn‚Äôt work for some reason.</p>
<p>But then, I learned about this cool thing called k3s, which is like a much more lightweight version of k8s. That‚Äôs perfect, because my machines are all very cheap and have very few resources. Additionally, someone made a <a href="https://github.com/alexellis/k3sup">very simple setup utility</a> that sets everything up on a remote for you, so I got k3s up around 10 PM. So, I could check tasks #1 and #6 off.</p>
<p>The whole reason I was doing this in the first place was to get an ELK<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> stack set up. I only got the E and K before I set up MetricBeat to record system metrics like memory and CPU usage. I got everything set up around 3 AM, then I felt really tired and went to bed. I guess that‚Äôs part of #2 (proper centralized logging) checked off.</p>
<hr/>
<h2 id="tuesday-119-setting-up-firefly-iii-and-filebeat">Tuesday 1/19: Setting up Firefly III and FileBeat</h2>
<p>The next morning, I woke up at 8 AM in pain because I did have class that day. Before class started at 9 AM, I set up Kibana to make cool graphs from the MetricBeat data collected overnight.</p>
<a href="/_/2021/01/21/janky-kube-cluster/kibana.png"><img src="/_/2021/01/21/janky-kube-cluster/kibana.png" alt="Cool and squiggly graphs that might have meanings" width="1200"/></a>
<p>After class, I went on the the second order of business, which was setting up those private apps like Firefly III on Kubernetes. I successfully migrated the persistent MySQL container data off of the VPS and onto <code>deskrap</code>, and after much finagling with configuration and secrets, it surprisingly worked without any data corruption.</p>
<p>After bombing an interview with Facebook, I got ahold of my mom‚Äôs old Acer Aspire E1-510 that she didn‚Äôt need anymore. It was running terribly slow because it was bloatware-infested Windows 10 on a HDD. Even after I installed Debian Buster Stable and k3s and named it <code>crappertop</code>, it was still kinda slow, but it‚Äôs fine; there were 3 nodes on my cluster and quantity &gt; quality here.</p>
<p>At the very end, I got FileBeat running on a DaemonSet pod to forward all container logs into Elasticsearch. I felt satisfied, then went to bed at around 2 AM.</p>
<h2 id="wednesday-120-expanding-the-cluster-further-then-realizing-i-made-a-boo-boo">Wednesday 1/20: Expanding the cluster further, then realizing I made a boo-boo</h2>
<p>Today, I added another machine to the cluster: a Thinkpad T420 that I got used off of eBay for a different experiment than <code>deskrap</code>. Once again, I installed Debian Buster Stable, named the Thinkpad <code>thonkpad</code>, and hooked it up to the rest of the k3s cluster. I also learned how to deploy containers with Helm charts, and declaratively deploy Helm charts with Helmfiles.</p>
<p>Sometime in the afternoon, I was trying to set up a VPN system so that I could access my containers behind authentication. I learned about Wireguard and how it‚Äôs much better than OpenVPN, but when I tried running <code>apt install -t bullseye-backports wireguard</code> on my machines like the instructions told me to, it couldn‚Äôt find Wireguard. It turns out that Debian 10 uses Linux kernel 4.19, which is too old for Wireguard. So, I had a small existential crisis before accepting my fate of having to go to all four machines and reinstall them with a different distro.</p>
<p>So that I don‚Äôt have to physically pull the machines onto my desk and use a USB stick as I have been doing, I decided to install Proxmox instead. Proxmox is a hypervisor, so I have to spin up a VM inside of it. However, I‚Äôd be slightly cheating; these machines are all so resource starved, I‚Äôm just gonna install a single fat VM on each of them and hopefully not experience too much overhead.</p>
<p>At first, I tried setting up OpenSUSE Kubic, which is a distro with k8s preinstalled for you. Then, I learned about K3OS, and installed that instead because, once again, I‚Äôm rather resource starved. While I was doing that, I was trying to set up Proxmox on <code>deskrap</code>, but the USB installer kept crashing. Maybe that machine is just too old/shitty for a modern hypervisor.</p>
<p>Now, as I‚Äôm writing this blog post, I‚Äôm trying to figure out how to move the elasticsearch data off of <code>cracktop</code>, which is the last node I have not attempted to install Proxmox on yet. I will say one thing, though: DevOps is <em>frustrating</em>. So much YAML-staring and hoping and praying things will work. I can only hope and pray at this point that the end result will be something I can be happy about.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn-1">Kubernetes is usually abbreviated to k8s because there‚Äôs 8 characters between k and s.<a href="#fnref-1" class="footnote-backref">‚Ü©</a></li>
<li id="fn-2">Elasticsearch, Logstash, and Kibana. Logstash gathers and parses logs, then it sends to Elasticsearch to index logs, and Kibana looks at the logs and makes cool squiggly graphs.<a href="#fnref-2" class="footnote-backref">‚Ü©</a></li>
</ol>
</div></div></article></article></div><div class="col-lg-4"><div class="longform-layout_sidebarGroup__1maJR"><table style="width:100%"><tbody><tr><th style="min-width:180px"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg> <!-- -->Date</th><td class="longform-layout_statusData__1GlEa">21 Jan 2021</td></tr></tbody></table></div><div class="longform-layout_sidebarGroup__1maJR"><h2>Tags</h2><div><p style="font-size:12pt;margin-bottom:3px"><a href="/projects/plebscale/"><span style="background-color:#86e600;color:#000000;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">/projects/plebscale/</span></a><a href="/t/devops"><span style="background-color:#47e000;color:#000000;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">devops</span></a><a href="/t/docker"><span style="background-color:#2391E6;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">Docker</span></a><a href="/t/elk"><span style="background-color:#a8009d;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">elk</span></a><a href="/t/kubernetes"><span style="background-color:#0039f5;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">kubernetes</span></a><a href="/t/proxmox"><span style="background-color:#eb0095;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">proxmox</span></a><a href="/t/server"><span style="background-color:#00a851;color:#ffffff;cursor:pointer" class="tag_tag__1JK8b p-category badge badge-secondary">server</span></a> </p></div></div></div></div></div><div class="container"><section id="comments"><h2>Comments</h2><div class="comments"><div><form class=""><div class="row form-group"><label for="comment-name" class="col-sm-4 col-form-label">Name (leave blank for anonymous)</label><div class="col-sm-8"><input type="text" name="name" id="comment-name" placeholder="Willy Shakespeare" class="form-control"/></div></div><div class="row form-group"><label for="comment-email" class="col-sm-4 col-form-label">Email (required)</label><div class="col-sm-8"><input type="email" name="email" id="comment-email" placeholder="user@example.com" class="form-control"/></div></div><div class="row form-group"><label for="comment-website" class="col-sm-4 col-form-label">Website</label><div class="col-sm-8"><input type="url" name="website" id="comment-website" placeholder="my.cool.site" class="form-control"/></div></div><div class="form-group"><label for="comment-body" class="">Comment (<!-- -->1000<!-- --> chars left)</label><textarea name="body" id="comment-body" placeholder="Type your comment here..." class="form-control"></textarea><small class="form-text text-muted">Markdown formatting is supported.</small></div><div class="row"><button type="button" class="btn btn-primary">Submit!</button></div></form></div></div></section></div></div><footer class="footer_footer__1KZqX"><div class="text-light small container"><div class="col"><nav class="row"><div class="col-6 col-sm-4"><a href="/privacy/">Privacy Policy</a></div><div class="col-6 col-sm-4"><a href="/licenses/">Open Source Licenses</a></div><div class="col-6 col-sm-4"><a href="/about/">About/Contact</a></div></nav></div><div class="col"><p>astrid.tech v<!-- -->2.0.0<!-- --> was created by Astrid Yu with a generous helping of <span title="tea" aria-label="tea" role="img">‚òï</span> and <span title="witchcraft" aria-label="witchcraft" role="img">üßô‚Äç</span>. See the<!-- --> <a href="/projects/astrid-tech/">self-referential project page</a> <!-- -->or see the code yourself on<!-- --> <a href="https://github.com/astralbijection/astrid.tech">GitHub</a>.</p></div><div class="row"><div class="col"></div></div><div class="row"><div class="text-center col"><a href="https://www.gnu.org/licenses/agpl-3.0.en.html"><img alt="GNU Affero General Public License" width="100" height="40" src="/agpl.png"/></a><p><a href="https://github.com/astralbijection/astrid.tech">The source code of astrid.tech</a> <!-- -->is licensed under the<!-- --> <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">AGPL License</a>.<!-- --> </p></div><div class="text-center col"><p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a><br/><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">The page content of astrid.tech</span> <!-- -->by<!-- --> <a xmlns:cc="http://creativecommons.org/ns#" href="https://astrid.tech" property="cc:attributionName" rel="cc:attributionURL">Astrid Yu</a> <!-- -->is licensed under a<!-- --> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":8,"assetRoot":"2021/01/21/janky-kube-cluster","thumbnail":null,"title":"A Kubernetes cluster but it's only made of used computers","description":"16-year-old me would be proud","slug":"janky-kube-cluster","date":"2021-01-21T06:14:00.000Z","content":"\u003cp\u003eIn \u003ca href=\"/2021/01/18/selfhost/\"\u003emy last post\u003c/a\u003e had 7 things I wanted to do. Well, here‚Äôs a summary of everything I did so far. The \u003ca href=\"https://github.com/astralbijection/astrid.tech-deployment\"\u003eIaC repo is here\u003c/a\u003e and the last commit before I published this article was \u003ca href=\"https://github.com/astralbijection/astrid.tech-deployment/tree/d18736ae4cf926c177488a07565521328ba09aee\"\u003ed18736\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eEDIT: It has come to my attention that I‚Äôm missing a picture. Anyways, here‚Äôs what the cluster looks like.\u003c/p\u003e\n\u003cimg src=\"/_/2021/01/21/janky-kube-cluster/cluster.jpeg\" alt=\"Hello from CyberCthulu\"\u003e\n\u003ch2 id=\"monday-118-setting-up-k8s-and-an-elastic-stack\"\u003eMonday 1/18: Setting up k8s and an Elastic stack\u003c/h2\u003e\n\u003cp\u003eI woke up awfully early that morning at 5 AM, way earlier than I usually wake up. It was MLK day, so I didn‚Äôt have classes, and so I decided to spend the day setting up Kubernetes. I started out with 2 machines, both running Debian Buster Stable:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe HP Pavilion x360 laptop with a cracked screen that I used to use before the screen cracked (named \u003ccode\u003ecracktop\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eAn old Dell Optiplex workstation (that STILL RUNS DDR2 mind you) I got off of eBay a few years ago for doing something similar (named \u003ccode\u003edeskrap\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI basically spent from 5 AM until 9 PM trying to set up k8s\u003csup id=\"fnref-1\"\u003e\u003ca href=\"#fn-1\" class=\"footnote-ref\"\u003e1\u003c/a\u003e\u003c/sup\u003e the Proper Way ‚Ñ¢Ô∏è on those two machines and it was painful and it didn‚Äôt work for some reason.\u003c/p\u003e\n\u003cp\u003eBut then, I learned about this cool thing called k3s, which is like a much more lightweight version of k8s. That‚Äôs perfect, because my machines are all very cheap and have very few resources. Additionally, someone made a \u003ca href=\"https://github.com/alexellis/k3sup\"\u003every simple setup utility\u003c/a\u003e that sets everything up on a remote for you, so I got k3s up around 10 PM. So, I could check tasks #1 and #6 off.\u003c/p\u003e\n\u003cp\u003eThe whole reason I was doing this in the first place was to get an ELK\u003csup id=\"fnref-2\"\u003e\u003ca href=\"#fn-2\" class=\"footnote-ref\"\u003e2\u003c/a\u003e\u003c/sup\u003e stack set up. I only got the E and K before I set up MetricBeat to record system metrics like memory and CPU usage. I got everything set up around 3 AM, then I felt really tired and went to bed. I guess that‚Äôs part of #2 (proper centralized logging) checked off.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"tuesday-119-setting-up-firefly-iii-and-filebeat\"\u003eTuesday 1/19: Setting up Firefly III and FileBeat\u003c/h2\u003e\n\u003cp\u003eThe next morning, I woke up at 8 AM in pain because I did have class that day. Before class started at 9 AM, I set up Kibana to make cool graphs from the MetricBeat data collected overnight.\u003c/p\u003e\n\u003cimg src=\"/_/2021/01/21/janky-kube-cluster/kibana.png\" alt=\"Cool and squiggly graphs that might have meanings\"\u003e\n\u003cp\u003eAfter class, I went on the the second order of business, which was setting up those private apps like Firefly III on Kubernetes. I successfully migrated the persistent MySQL container data off of the VPS and onto \u003ccode\u003edeskrap\u003c/code\u003e, and after much finagling with configuration and secrets, it surprisingly worked without any data corruption.\u003c/p\u003e\n\u003cp\u003eAfter bombing an interview with Facebook, I got ahold of my mom‚Äôs old Acer Aspire E1-510 that she didn‚Äôt need anymore. It was running terribly slow because it was bloatware-infested Windows 10 on a HDD. Even after I installed Debian Buster Stable and k3s and named it \u003ccode\u003ecrappertop\u003c/code\u003e, it was still kinda slow, but it‚Äôs fine; there were 3 nodes on my cluster and quantity \u003e quality here.\u003c/p\u003e\n\u003cp\u003eAt the very end, I got FileBeat running on a DaemonSet pod to forward all container logs into Elasticsearch. I felt satisfied, then went to bed at around 2 AM.\u003c/p\u003e\n\u003ch2 id=\"wednesday-120-expanding-the-cluster-further-then-realizing-i-made-a-boo-boo\"\u003eWednesday 1/20: Expanding the cluster further, then realizing I made a boo-boo\u003c/h2\u003e\n\u003cp\u003eToday, I added another machine to the cluster: a Thinkpad T420 that I got used off of eBay for a different experiment than \u003ccode\u003edeskrap\u003c/code\u003e. Once again, I installed Debian Buster Stable, named the Thinkpad \u003ccode\u003ethonkpad\u003c/code\u003e, and hooked it up to the rest of the k3s cluster. I also learned how to deploy containers with Helm charts, and declaratively deploy Helm charts with Helmfiles.\u003c/p\u003e\n\u003cp\u003eSometime in the afternoon, I was trying to set up a VPN system so that I could access my containers behind authentication. I learned about Wireguard and how it‚Äôs much better than OpenVPN, but when I tried running \u003ccode\u003eapt install -t bullseye-backports wireguard\u003c/code\u003e on my machines like the instructions told me to, it couldn‚Äôt find Wireguard. It turns out that Debian 10 uses Linux kernel 4.19, which is too old for Wireguard. So, I had a small existential crisis before accepting my fate of having to go to all four machines and reinstall them with a different distro.\u003c/p\u003e\n\u003cp\u003eSo that I don‚Äôt have to physically pull the machines onto my desk and use a USB stick as I have been doing, I decided to install Proxmox instead. Proxmox is a hypervisor, so I have to spin up a VM inside of it. However, I‚Äôd be slightly cheating; these machines are all so resource starved, I‚Äôm just gonna install a single fat VM on each of them and hopefully not experience too much overhead.\u003c/p\u003e\n\u003cp\u003eAt first, I tried setting up OpenSUSE Kubic, which is a distro with k8s preinstalled for you. Then, I learned about K3OS, and installed that instead because, once again, I‚Äôm rather resource starved. While I was doing that, I was trying to set up Proxmox on \u003ccode\u003edeskrap\u003c/code\u003e, but the USB installer kept crashing. Maybe that machine is just too old/shitty for a modern hypervisor.\u003c/p\u003e\n\u003cp\u003eNow, as I‚Äôm writing this blog post, I‚Äôm trying to figure out how to move the elasticsearch data off of \u003ccode\u003ecracktop\u003c/code\u003e, which is the last node I have not attempted to install Proxmox on yet. I will say one thing, though: DevOps is \u003cem\u003efrustrating\u003c/em\u003e. So much YAML-staring and hoping and praying things will work. I can only hope and pray at this point that the end result will be something I can be happy about.\u003c/p\u003e\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn-1\"\u003eKubernetes is usually abbreviated to k8s because there‚Äôs 8 characters between k and s.\u003ca href=\"#fnref-1\" class=\"footnote-backref\"\u003e‚Ü©\u003c/a\u003e\u003c/li\u003e\n\u003cli id=\"fn-2\"\u003eElasticsearch, Logstash, and Kibana. Logstash gathers and parses logs, then it sends to Elasticsearch to index logs, and Kibana looks at the logs and makes cool squiggly graphs.\u003ca href=\"#fnref-2\" class=\"footnote-backref\"\u003e‚Ü©\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e","tags":["/projects/plebscale/","devops","docker","elk","kubernetes","proxmox","server"]}},"__N_SSG":true},"page":"/[year]/[month]/[day]/[...slug]","query":{"year":"2021","month":"01","day":"21","slug":["janky-kube-cluster"]},"buildId":"xu5MpDjzYRyNj4te1Gtrv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>