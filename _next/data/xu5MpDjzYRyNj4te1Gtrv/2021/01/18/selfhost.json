{"pageProps":{"post":{"id":9,"assetRoot":"2021/01/18/selfhost","thumbnail":null,"title":"Simple Self-Hosting with Docker","description":"\"But it works on my computer!\" \"Then we'll ship your computer.\"\n","slug":"selfhost","date":"2021-01-18T15:49:00.000Z","content":"<p>Setting servers up is a pain in the ass. There’s so many installation steps for each service, and then there’s the potential for conflicting services, and then when you have to set everything up again due to migration or something like that, you give up because it’s just so much manual work. Luckily, I have Docker to make things less difficult.</p>\n<!-- excerpt -->\n<p>On my VPS, I’m running several dockerized self-hosted apps right now, including:</p>\n<ul>\n<li>api.astrid.tech, the backend to this website that I was talking about <a href=\"/2020/12/20/backend\">last issue</a></li>\n<li><a href=\"https://caddyserver.com/\">Caddy</a> as the reverse proxy for everything</li>\n<li><a href=\"https://github.com/zadam/trilium\">Trilium Notes</a>, on <a href=\"https://notes.astrid.tech/\">notes.astrid.tech</a>, and password-protected so you can’t access it >:(</li>\n<li><a href=\"https://openvpn.net/\">OpenVPN</a>, on vpn.astrid.tech</li>\n<li><a href=\"https://www.firefly-iii.org/\">Firefly III</a>, on the OpenVPN network</li>\n<li><a href=\"https://www.keycloak.org/\">Keycloak</a>, which I haven’t figured out how to use for authentication yet</li>\n<li><a href=\"https://www.dokuwiki.org/dokuwiki\">DokuWiki</a>, on <a href=\"https://wiki.dnd.astrid.tech/\">wiki.dnd.astrid.tech</a>, for keeping track of the D&#x26;D campaign I’m running and possibly future ones too</li>\n</ul>\n<p>These are all configured with the <a href=\"https://github.com/astralbijection/astrid.tech-deployment\">IaC repo here</a>. The last commit before I published this article was <a href=\"https://github.com/astralbijection/astrid.tech-deployment/tree/56e26b678b5c14026da32e920f4804554fcdcf9e\">commit 56e26b</a>.</p>\n<h2 id=\"organization\">Organization</h2>\n<p>Every app gets its own docker-compose file and folder. This makes it easy for me to test that everything runs and is configured correctly on my local machine. Once I’m done with ensuring that I didn’t royally fuck up the configs, I’m probably 80% of the way there. I can push to the git repo and run the app in production.</p>\n<h2 id=\"networks\">Networks</h2>\n<p>Every app gets its own internal network for compartmentalization. However, there are a couple of shared networks that I’m using for specific purposes:</p>\n<ul>\n<li><code>proxied</code>: This network includes the Caddy proxy server and every app with a web interface.</li>\n<li><code>vpn</code>: This network includes the OpenVPN server and every app that I want to restrict.</li>\n</ul>\n<h2 id=\"where-to-go-from-here\">Where to go from here?</h2>\n<p>I have a whole checklist of things I want to try next.</p>\n<ol>\n<li>\n<p><strong>Recomission my old laptop into a server hooked up to the VPN.</strong> This will allow me to cheaply and relatively securely extend the functionalities of my infrastructure.</p>\n</li>\n<li>\n<p><strong>Proper centralized logging.</strong> I will run <a href=\"https://www.elastic.co/beats/filebeat\">FileBeat</a> and possibly a few other <a href=\"https://www.elastic.co/beats/\">Beats</a> on the VPS, then run and an <a href=\"https://www.elastic.co/what-is/elk-stack\">ELK stack</a> on the laptop. I’m doing it this way instead of just running ELK on the VPS mostly for performance reasons; from what I’ve heard, ElasticSearch is a memory and CPU hog. There’s some nice security benefits that come with that too, because (in theory) it will be hard to get to my laptop.</p>\n<img src=\"/_/2021/01/18/selfhost/planned-infra.svg\" alt=\"The infrastructure will probably look like this at some point.\">\n</li>\n<li>\n<p><strong>Actually set up backups.</strong> I don’t know how I’m planning on doing this, but I imagine it’s probably best to do it on my VPN-connected laptop as well. You might notice that there’s a lot dependent on the VPN laptop.</p>\n</li>\n<li>\n<p><strong>Expand the network.</strong> I learned from someone at the <a href=\"https://cplug.org/\">Cal Poly Linux Users Group</a> that Oracle gives you <a href=\"https://www.oracle.com/cloud/free/\">two free 1GB 1-core</a> VPSes, along with 2 databases, a bunch of storage, and a load balancer! I can definitely move my OpenVPN server to one of these, for further compartmentalization of my network. As for the other one, I’ll have to figure something else to run on that.</p>\n</li>\n<li>\n<p><strong>Further expand the network.</strong> I estimate I have around 4 non-zero Raspberry Pis lying around my room (I think there’s a 2B, 3B, 3B, and 3B+, but don’t quote me on that). One of those is being used for OctoPrint, but suppose I were to cluster the other three and run god knows what on them…</p>\n</li>\n<li>\n<p><strong>Learn Kubernetes.</strong> If I’ve accomplished steps (1) and (4), then I’ll have 4 different machines I’m working with. Step (5) will mean I have 7 machines. It might be a good idea to learn how to Kubernetes. I think I can do it with step (5).</p>\n</li>\n<li>\n<p><strong>Self-host MOAR apps!</strong> Server management is painful sometimes, but it’s really fun! The end product is a complicated, well-functioning system that works, and that’s always really satisfying.</p>\n</li>\n</ol>","tags":["devops","docker","server"]}},"__N_SSG":true}